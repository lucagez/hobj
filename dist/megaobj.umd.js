!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.megaobj=e()}(this,function(){var t=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return t.forEach(function(t){return t.apply(void 0,e)})}},e=function(t){return String(t).split(".")};function n(t){return function(e,n){var r=Array.from(this[t+"Q"].get(e)||[]).concat([n]);this[t+"Q"].set(e,r)}}var r={_get:function(t){return e(t).reduce(function(t,e){return t&&t[e]},this.store)},_set:function t(n,r,i,o){void 0===i&&(i=this.store),void 0===o&&(o=null);var s=o||e(n),u=s[0];if(i)return void 0===i[u]&&(i[u]={},1===s.length)?(i[u]=r,this.store):(s.shift(),t(n,r,i[u],s))},_has:function(t){return void 0!==this._get(t)},_delete:function t(n,r,i){void 0===r&&(r=this.store),void 0===i&&(i=null);var o=i||e(n),s=o[0];return void 0!==r[s]&&(1===o.length?(delete r[s],!0):(o.shift(),t(n,r[s],o)))},_clear:function(){this.store={}},_sub:function(t){return JSON.parse(JSON.stringify(t?this._get(t):this.store))},_for:function(t){var e=this;return function(n){var r=e.storeSelect(t);for(var i in r)n(i)}},_keys:function(t){var e=this.storeSelect(t);return Object.keys(e)},_size:function(t){var e=this.storeSelect(t);return Object.keys(e).length},_sizeDeep:function(t,e){void 0===e&&(e=!0);var n=0;return this._forDeep(t,e)(function(){return n+=1}),n},_entries:function(t){var e=this.storeSelect(t);return this._keys(t).map(function(t){return[t,e[t]]})},_forDeep:function(t,e){void 0===t&&(t=""),void 0===e&&(e=!0);var n=this.storeSelect(t);return function(r){if("function"!=typeof r)throw new TypeError("Func must be a function");!function n(i,o){if(void 0===o&&(o=[]),void 0!==i){var s=t+o.join(".");return e?"object"!=typeof i&&r(i,s):r(i,s),Object.keys(i).map(function(t){return n(i[t],o.concat([t]))})}}(n)}}},i=function(e){var i=this;void 0===e&&(e={}),this.store=e,this.beforeQ=new Map,this.afterQ=new Map,Object.keys(r).forEach(function(t){return i["_"+t]=r[t].bind(i)}),this.methods.forEach(function(e){return i[e]=function(e){return function(){for(var n,r=this,i=[],o=arguments.length;o--;)i[o]=arguments[o];return t(this.beforeQ.get(e)||[]).apply(void 0,i),Promise.resolve().then(function(){return t(r.afterQ.get(e)||[]).apply(void 0,i)}),(n=this)["_"+e].apply(n,i)}}(e).bind(i)}),this.storeSelect=function(t){return void 0===t&&(t=""),""!==t?this._get(t):this.store}.bind(this),this.before=n("before").bind(this),this.after=n("after").bind(this)};return i.prototype.methods=["get","set","has","delete","clear","sub","for","keys","size","sizeDeep","entries","forDeep"],i});
