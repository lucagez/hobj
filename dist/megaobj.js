var t=function(t){return function(){for(var i=[],e=arguments.length;e--;)i[e]=arguments[e];return t.forEach(function(t){return t.apply(void 0,i)})}},i=function(t){return t.split(".")};function e(t){return function(i,e){var n=Array.from(this[t+"Q"].get(i)||[]).concat([e]);this[t+"Q"].set(i,n)}}var n=function(n){var r=this;void 0===n&&(n={}),this.store=n,this.beforeQ=new Map,this.afterQ=new Map,this._get=function(t){return i(t).reduce(function(t,i){return t&&t[i]},this.store)}.bind(this),this._set=function t(e,n,r,s){void 0===r&&(r=this.store),void 0===s&&(s=null);var o=s||i(e),h=o[0];if(r)return void 0===r[h]&&(r[h]={},1===o.length)?(r[h]=n,this.store):(o.shift(),t(e,n,r[h],o))}.bind(this),this._has=function(t){return void 0!==this._get(t)}.bind(this),this._delete=function t(e,n,r){void 0===n&&(n=this.store),void 0===r&&(r=null);var s=r||i(e),o=s[0];return void 0!==n[o]&&(1===s.length?(delete n[o],!0):(s.shift(),t(e,n[o],s)))}.bind(this),this._clear=function(){this.store={}}.bind(this),this._sub=function(t){return JSON.parse(JSON.stringify(this._get(t)))}.bind(this),this._for=function(t){for(var i in this.store)t(i)}.bind(this),this._keys=function(){return Object.keys(this.store)}.bind(this),this._entries=function(){var t=this;return this._keys().map(function(i){return[i,t.store[i]]})}.bind(this),this._forDeep=function(t,i){void 0===t&&(t=""),void 0===i&&(i=!0);var e=""!==t?this._get(t):this.store;return function(t){if("function"!=typeof t)throw new Error("Func must be a function");!function e(n,r){if(void 0===r&&(r=[]),void 0!==n){var s=r.join(".");return i?"object"!=typeof n&&t(n,s):t(n,s),Object.keys(n).map(function(t){return e(n[t],r.concat([t]))})}}(e)}}.bind(this),this._size=function(t){void 0===t&&(t="");var i=""!==t?this._get(t):this.store;return Object.keys(i).length}.bind(this),this._sizeDeep=function(t,i){void 0===t&&(t=""),void 0===i&&(i=!0);var e=0;return this._forDeep(t,i)(function(){return e+=1}),e}.bind(this),this.methods.forEach(function(i){return r[i]=function(i){return function(){for(var e,n=this,r=[],s=arguments.length;s--;)r[s]=arguments[s];return t(this.beforeQ.get(i)||[]).apply(void 0,r),Promise.resolve().then(function(){return t(n.afterQ.get(i)||[]).apply(void 0,r)}),(e=this)["_"+i].apply(e,r)}}(i).bind(r)}),this.before=e("before").bind(this),this.after=e("after").bind(this)};n.prototype.methods=["get","set","has","delete","clear","sub","for","keys","size","sizeDeep","entries","forDeep"],module.exports=n;
