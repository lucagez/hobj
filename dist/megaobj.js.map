{"version":3,"file":"megaobj.js","sources":["../src/utils.mjs","../src/methods.mjs","../src/megaobj.mjs"],"sourcesContent":["\n// Executing every function with the passed value as argument\nconst every = funcs => (...args) => funcs.forEach(func => func(...args));\n\nconst split = str => String(str).split('.');\n\nfunction storeSelect(start = '') {\n  return start !== '' ? this._get(start) : this.store;\n}\n\nfunction wrapper(method) {\n  return function scoped(...args) {\n    // BEFORE\n    every(this.beforeQ.get(method) || [])(...args);\n\n    // AFTER\n    // (microtask executed on nextTick)\n    // NOTE: using Promise for keeping browser compatibility.\n    Promise\n      .resolve()\n      .then(() => every(this.afterQ.get(method) || [])(...args));\n\n    // MIDDLE\n    return this[`_${method}`](...args);\n  };\n}\n\nexport {\n  every,\n  split,\n  wrapper,\n  storeSelect,\n};\n","import { split } from './utils';\n\nfunction on(when) {\n  return function scoped(method, func) {\n    const actual = Array.from(\n      this[`${when}Q`].get(method) || [],\n    );\n    const queue = [...actual, func];\n\n    this[`${when}Q`].set(method, queue);\n  };\n}\n\n// Reducing object to final value\nfunction _get(path) {\n  return split(path).reduce((a, b) => a && a[b], this.store);\n}\n\nfunction _has(path) {\n  return typeof this._get(path) !== 'undefined';\n}\n\nfunction _delete(path, obj = this.store, acc = null) {\n  const props = acc || split(path);\n  const first = props[0];\n  if (typeof obj[first] === 'undefined') return false;\n  if (props.length === 1) {\n    delete obj[first];\n    return true;\n  }\n  props.shift();\n  return _delete(path, obj[first], props);\n}\n\nfunction _set(path, value, obj = this.store, acc = null) {\n  const props = acc || split(path);\n  const first = props[0];\n  if (!obj) return;\n  if (typeof obj[first] === 'undefined') {\n    obj[first] = {};\n    if (props.length === 1) {\n      obj[first] = value;\n      return this.store;\n    }\n  }\n  props.shift();\n  return _set(path, value, obj[first], props);\n}\n\nfunction _sub(path) {\n  return JSON.parse(\n    JSON.stringify(\n      this._get(path),\n    ),\n  );\n}\n\nfunction _forDeep(start, end = true) {\n  const store = this.storeSelect(start);\n  return function (func) {\n    if (typeof func !== 'function') throw new TypeError('Func must be a function');\n\n    (function scoped(obj, acc = []) {\n      if (typeof obj === 'undefined') return;\n\n      const path = acc.join('.');\n      if (end) {\n        if (typeof obj !== 'object') func(obj, path);\n      } else func(obj, path);\n\n\n      // Recursively going deeper.\n      // NOTE: While going deeper, the current prop is pushed into the accumulator\n      // to keep track of the position inside of the object.\n      return Object\n        .keys(obj)\n        .map(prop => scoped(obj[prop], [...acc, prop]));\n    }(store));\n  };\n}\n\nfunction _size(start) {\n  const store = this.storeSelect(start);\n  return Object.keys(store).length;\n}\n\nfunction _sizeDeep(start, end = true) {\n  let c = 0;\n  this._forDeep(start, end)(() => c += 1);\n  return c;\n}\n\nfunction _for(start, func) {\n  const store = this.storeSelect(start);\n  for (const prop in store) {\n    func(prop);\n  }\n}\n\nfunction _keys(start) {\n  const store = this.storeSelect(start);\n  return Object.keys(store);\n}\n\nfunction _entries(start) {\n  return this._keys(start).map(prop => [prop, this.store[prop]]);\n}\n\nfunction _clear() {\n  this.store = {};\n}\n\nexport {\n  on,\n  _get,\n  _set,\n  _has,\n  _delete,\n  _clear,\n  _sub,\n  _for,\n  _keys,\n  _size,\n  _sizeDeep,\n  _entries,\n  _forDeep,\n};\n","import { wrapper, storeSelect } from './utils';\nimport {\n  on,\n  _get,\n  _set,\n  _has,\n  _delete,\n  _clear,\n  _sub,\n  _for,\n  _keys,\n  _size,\n  _sizeDeep,\n  _entries,\n  _forDeep,\n} from './methods';\n\nexport default class MegaObj {\n  constructor(init = {}) {\n    this.store = init;\n\n    // Storing the queues to be executed before and after each method\n    this.beforeQ = new Map();\n    this.afterQ = new Map();\n\n    this._get = _get.bind(this);\n    this._set = _set.bind(this);\n    this._has = _has.bind(this);\n    this._delete = _delete.bind(this);\n\n    this._clear = _clear.bind(this);\n    this._sub = _sub.bind(this);\n    this._for = _for.bind(this);\n    this._keys = _keys.bind(this);\n    this._entries = _entries.bind(this);\n    this._forDeep = _forDeep.bind(this);\n    this._size = _size.bind(this);\n    this._sizeDeep = _sizeDeep.bind(this);\n\n    this.methods\n      .forEach(method => this[method] = wrapper(method).bind(this));\n\n    this.storeSelect = storeSelect.bind(this);\n    this.before = on('before').bind(this);\n    this.after = on('after').bind(this);\n  }\n}\n\nMegaObj.prototype.methods = [\n  'get',\n  'set',\n  'has',\n  'delete',\n  'clear',\n  'sub',\n  'for',\n  'keys',\n  'size',\n  'sizeDeep',\n  'entries',\n  'forDeep',\n];\n"],"names":["const","every","funcs","forEach","func","args","split","str","String","storeSelect","start","_get","store","wrapper","method","scoped","beforeQ","get","Promise","resolve","then","this","afterQ","on","when","actual","Array","from","queue","set","path","reduce","a","b","_has","_delete","obj","acc","props","first","length","shift","_set","value","_sub","JSON","parse","stringify","_forDeep","end","TypeError","join","Object","keys","map","prop","_size","_sizeDeep","c","_for","_keys","_entries","_clear","MegaObj","constructor","init","Map","bind","methods","before","after","prototype"],"mappings":"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"}