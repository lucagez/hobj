!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.hobj=e()}(this,function(){var t=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return t.forEach(function(t){return t.apply(void 0,e)})}},e=function(t){return String(t).split(".")};function n(t){return function(e,n){var r=Array.from(this[t+"Q"].get(e)||[]).concat([n]);this[t+"Q"].set(e,r)}}var r={_get:function(t){return e(t).reduce(function(t,e){return t&&t[e]},this.store)},_set:function t(n,r,i,o,u){void 0===i&&(i=this.store),void 0===o&&(o=null),void 0===u&&(u=this.store);var s=o||e(n),f=s[0];if(i)return void 0===i[f]&&(i[f]={}),1===s.length?(i[f]=r,u):(s.shift(),t(n,r,i[f],s,u))},_has:function(t){return void 0!==this._get(t)},_delete:function t(n,r,i){void 0===r&&(r=this.store),void 0===i&&(i=null);var o=i||e(n),u=o[0];return void 0!==r[u]&&(1===o.length?(delete r[u],!0):(o.shift(),t(n,r[u],o)))},_clear:function(t,e){if(!t&&!e)return this.store={};this[t+"Q"].set(e,[])},_sub:function(t){return JSON.parse(JSON.stringify(t?this._get(t):this.store))},_for:function(t){var e=this;return function(n){if("function"!=typeof n)throw new TypeError("Func must be a function");var r=e.storeSelect(t);for(var i in r)n(i,r[i])}},_keys:function(t){var e=this.storeSelect(t);return Object.keys(e)},_size:function(t){var e=this.storeSelect(t);return Object.keys(e).length},_sizeDeep:function(t,e){void 0===e&&(e=!0);var n=0;return this._forDeep(t,e)(function(){return n+=1}),n},_entries:function(t){var e=this.storeSelect(t);return this._keys(t).map(function(t){return[t,e[t]]})},_forDeep:function(t,e){void 0===t&&(t=""),void 0===e&&(e=!0);var n=this.storeSelect(t);return function(r,i){if("function"!=typeof r)throw new TypeError("Func must be a function");!function n(i,o){if(void 0===o&&(o=[]),void 0!==i){var u=t+o.join(".");if(e?("object"!=typeof i||Array.isArray(i))&&r(u,i):r(u,i),"object"==typeof i)return Object.keys(i).map(function(t){return n(i[t],o.concat([t]))})}}(i||n)}},_merge:function(t){var e=this;return void 0===t&&(t={}),this._forDeep("",!0)(function(t,n){return e._set(t,n)},t),this.store}};return function(e){var i=this;void 0===e&&(e={}),this.store=e,this.beforeQ=new Map,this.afterQ=new Map,this.methods=Object.keys(r).map(function(t){return{pure:t,normal:t.replace("_","")}}),this.methods.forEach(function(t){var e=t.pure;return i[e]=r[e].bind(i)}),this.methods.forEach(function(e){var n,r=e.normal;return i[r]=(n=r,function(){for(var e,r,i,o=this,u=[],s=arguments.length;s--;)u[s]=arguments[s];return t(this.beforeQ.get(n)||[]).apply(void 0,u),Promise.resolve().then(function(){return t(o.afterQ.get(n)||[]).apply(void 0,u.concat([e]))}),i=(r=o)["_"+n].apply(r,u),e=i,i}).bind(i)}),this.storeSelect=function(t){return void 0===t&&(t=""),""!==t?this._get(t):this.store}.bind(this),this.before=n("before").bind(this),this.after=n("after").bind(this)}});
