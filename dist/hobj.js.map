{"version":3,"file":"hobj.js","sources":["../src/utils.mjs","../src/methods.mjs","../src/hobj.mjs"],"sourcesContent":["\n// Executing every function with the passed value as argument\nconst every = funcs => (...args) => funcs.forEach(func => func(...args));\n\n// Coercing input to string to avoid errors when splitting.\n// NOTE: a js object stringify every property (1 => '1').\nconst split = str => String(str).split('.');\n\nfunction storeSelect(start = '') {\n  return start !== '' ? this._get(start) : this.store;\n}\n\nfunction on(when) {\n  return function scoped(method, func) {\n    const actual = Array.from(\n      this[`${when}Q`].get(method) || [],\n    );\n    const queue = [...actual, func];\n\n    this[`${when}Q`].set(method, queue);\n  };\n}\n\nfunction wrapper(method) {\n  return function scoped(...args) {\n    // BEFORE\n    every(this.beforeQ.get(method) || [])(...args);\n\n    // AFTER\n    // (microtask executed on nextTick)\n    // NOTE: using Promise for keeping browser compatibility.\n    let execution;\n    Promise\n      .resolve()\n      // Passing both the args used for the method invocation and the result of the method\n      .then(() => every(this.afterQ.get(method) || [])(...args, execution));\n\n    // MIDDLE\n    return (() => {\n      // Computing the result and saving it in a ariable that will be picked up\n      // during AFTER execution.\n\n      // NOTE: the wrapper function will return the result before\n      // starting the after queue.\n      const result = this[`_${method}`](...args);\n      execution = result;\n      return result;\n    })();\n  };\n}\n\nexport {\n  on,\n  every,\n  split,\n  wrapper,\n  storeSelect,\n};\n","import { split } from './utils';\n\n// Reducing object to final value\nfunction _get(path) {\n  return split(path).reduce((a, b) => a && a[b], this.store);\n}\n\nfunction _has(path) {\n  return typeof this._get(path) !== 'undefined';\n}\n\nfunction _delete(path, obj = this.store, acc = null) {\n  const props = acc || split(path);\n  const first = props[0];\n  if (typeof obj[first] === 'undefined') return false;\n  if (props.length === 1) {\n    delete obj[first];\n    return true;\n  }\n  props.shift();\n  return _delete(path, obj[first], props);\n}\n\nfunction _set(path, value, obj = this.store, acc = null, ref = this.store) {\n  const props = acc || split(path);\n  const first = props[0];\n  if (!obj) return;\n  if (typeof obj[first] === 'undefined') {\n    obj[first] = {};\n  }\n  if (props.length === 1) {\n    obj[first] = value;\n    return ref;\n  }\n  props.shift();\n  return _set(path, value, obj[first], props, ref);\n}\n\n// If no path is provided `_sub` acts like a deep clone\n// for the entire object.\nfunction _sub(path) {\n  return JSON.parse(\n    JSON.stringify(\n      path ? this._get(path) : this.store,\n    ),\n  );\n}\n\nfunction _for(path) {\n  return (func) => {\n    if (typeof func !== 'function') throw new TypeError('Func must be a function');\n\n    const store = this.storeSelect(path);\n    for (const prop in store) {\n      func(prop, store[prop]);\n    }\n  };\n}\n\nfunction _forDeep(path = '', end = true) {\n  const store = this.storeSelect(path);\n  return (func, ref) => {\n    if (typeof func !== 'function') throw new TypeError('Func must be a function');\n\n    (function scoped(obj, acc = []) {\n      if (typeof obj === 'undefined') return;\n\n      const usedPath = path + acc.join('.');\n      if (end) {\n        // An array is actually considered an object.\n        // However, in the context of a js object, is an end property.\n        if (typeof obj !== 'object' || Array.isArray(obj)) func(usedPath, obj);\n      } else func(usedPath, obj);\n\n\n      if (typeof obj !== 'object') return;\n      // Recursively going deeper.\n      // NOTE: While going deeper, the current prop is pushed into the accumulator\n      // to keep track of the position inside of the object.\n      return Object\n        .keys(obj)\n        .map(prop => scoped(obj[prop], [...acc, prop]));\n    }(ref || store));\n  };\n}\n\n// DEEP merge utility.\n// Simply iterating and setting.\nfunction _merge(ref) {\n  this._forDeep('', true)((path, value) => this._set(path, value), ref);\n}\n\nfunction _size(path) {\n  const store = this.storeSelect(path);\n  return Object.keys(store).length;\n}\n\nfunction _sizeDeep(path, end = true) {\n  let c = 0;\n  this._forDeep(path, end)(() => c += 1);\n  return c;\n}\n\nfunction _keys(path) {\n  const store = this.storeSelect(path);\n  return Object.keys(store);\n}\n\nfunction _entries(path) {\n  const store = this.storeSelect(path);\n  return this._keys(path).map(prop => [prop, store[prop]]);\n}\n\nfunction _clear() {\n  this.store = {};\n}\n\nexport default {\n  _get,\n  _set,\n  _has,\n  _delete,\n  _clear,\n  _sub,\n  _for,\n  _keys,\n  _size,\n  _sizeDeep,\n  _entries,\n  _forDeep,\n  _merge,\n};\n","import { on, wrapper, storeSelect } from './utils';\nimport _methods from './methods';\n\nexport default class Hobj {\n  constructor(init = {}) {\n    this.store = init;\n\n    // Storing the queues to be executed before and after each method\n    this.beforeQ = new Map();\n    this.afterQ = new Map();\n\n    // There are two version of every method.\n    this.methods = Object\n      .keys(_methods)\n      .map(pure => ({ pure, normal: pure.replace('_', '') }));\n\n    // - Normal version `method` => is ALWAYS hooked.\n    // before/after queue will be executed when invoking a normal method.\n\n    // - Pure version `_method` => Pure method. No hooks.\n\n    // Setting pure methods\n    this.methods\n      .forEach(({ pure }) => this[pure] = _methods[pure].bind(this));\n\n    // Setting hooked (normal) version.\n    this.methods\n      .forEach(({ normal }) => this[normal] = wrapper(normal).bind(this));\n\n    this.storeSelect = storeSelect.bind(this);\n    this.before = on('before').bind(this);\n    this.after = on('after').bind(this);\n  }\n}\n"],"names":["const","every","funcs","forEach","func","args","split","str","String","storeSelect","start","_get","store","on","when","scoped","method","actual","Array","from","get","queue","set","wrapper","beforeQ","execution","Promise","resolve","then","this","afterQ","result","path","reduce","a","b","_has","_delete","obj","acc","props","first","length","shift","_set","value","ref","_sub","JSON","parse","stringify","_for","TypeError","prop","_forDeep","end","usedPath","join","isArray","Object","keys","map","_merge","_size","_sizeDeep","c","_keys","_entries","_clear","Hobj","constructor","init","Map","methods","_methods","pure","replace","bind","normal","before","after"],"mappings":"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"}